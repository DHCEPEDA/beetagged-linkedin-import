<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BeeTagged - Contact Manager</title>
  <link rel="stylesheet" href="/css/styles.css">
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f7f7f7;
      color: #4a4a4a;
      line-height: 1.6;
    }
    
    header {
      background-color: white;
      padding: 15px 0;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 20px;
    }
    
    .header-content {
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    
    .logo {
      display: flex;
      align-items: center;
    }
    
    .logo img {
      height: 40px;
      margin-right: 10px;
    }
    
    .logo h1 {
      font-size: 24px;
      margin: 0;
      color: #f5a623;
    }
    
    .nav-links {
      display: flex;
      gap: 20px;
    }
    
    .nav-links a {
      text-decoration: none;
      color: #4a4a4a;
      font-weight: 500;
    }
    
    .main-content {
      padding: 40px 0;
    }
    
    .page-title {
      margin-bottom: 30px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .page-title h2 {
      margin: 0;
    }
    
    .auth-indicator {
      display: flex;
      align-items: center;
      padding: 8px 15px;
      border-radius: 20px;
      background-color: #f0f0f0;
    }
    
    .auth-indicator.facebook {
      background-color: #e7f0ff;
      color: #1877F2;
    }
    
    .auth-indicator.linkedin {
      background-color: #e7f0ff;
      color: #0077B5;
    }
    
    .auth-indicator.none {
      background-color: #f0f0f0;
      color: #666;
    }
    
    .auth-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      margin-right: 8px;
    }
    
    .auth-dot.facebook {
      background-color: #1877F2;
    }
    
    .auth-dot.linkedin {
      background-color: #0077B5;
    }
    
    .auth-dot.none {
      background-color: #999;
    }
    
    .search-bar {
      display: flex;
      margin-bottom: 30px;
    }
    
    .search-input {
      flex-grow: 1;
      padding: 10px 15px;
      border: 1px solid #ddd;
      border-radius: 4px 0 0 4px;
      font-size: 16px;
    }
    
    .search-btn {
      background-color: #f5a623;
      color: white;
      border: none;
      padding: 0 20px;
      border-radius: 0 4px 4px 0;
      font-weight: 600;
      cursor: pointer;
    }
    
    .toolbar {
      display: flex;
      justify-content: space-between;
      margin-bottom: 20px;
    }
    
    .filter-controls {
      display: flex;
      gap: 10px;
    }
    
    .filter-btn {
      padding: 8px 15px;
      background-color: white;
      border: 1px solid #ddd;
      border-radius: 4px;
      cursor: pointer;
    }
    
    .filter-btn.active {
      background-color: #f5a623;
      color: white;
      border-color: #f5a623;
    }
    
    .view-controls {
      display: flex;
      gap: 10px;
    }
    
    .view-btn {
      padding: 8px 15px;
      background-color: white;
      border: 1px solid #ddd;
      border-radius: 4px;
      cursor: pointer;
    }
    
    .view-btn.active {
      background-color: #f5a623;
      color: white;
      border-color: #f5a623;
    }
    
    .contacts-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 20px;
      margin-bottom: 40px;
    }
    
    .contact-card {
      background-color: white;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      transition: transform 0.2s ease;
    }
    
    .contact-card:hover {
      transform: translateY(-5px);
    }
    
    .contact-header {
      display: flex;
      padding: 15px;
      background-color: #f9f9f9;
      border-bottom: 1px solid #eee;
    }
    
    .contact-avatar {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      overflow: hidden;
    }
    
    .contact-avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    
    .contact-name-info {
      margin-left: 15px;
    }
    
    .contact-name {
      font-size: 18px;
      font-weight: 600;
      margin: 0 0 5px;
    }
    
    .contact-title {
      font-size: 14px;
      color: #666;
      margin: 0;
    }
    
    .contact-source {
      margin-left: auto;
      align-self: flex-start;
      font-size: 12px;
      padding: 4px 8px;
      border-radius: 4px;
    }
    
    .contact-source.facebook {
      background-color: #e7f0ff;
      color: #1877F2;
    }
    
    .contact-source.linkedin {
      background-color: #e7f0ff;
      color: #0077B5;
    }
    
    .contact-body {
      padding: 15px;
    }
    
    .contact-detail {
      margin-bottom: 10px;
    }
    
    .contact-detail-label {
      font-size: 12px;
      color: #999;
      margin-bottom: 3px;
    }
    
    .contact-detail-value {
      font-size: 14px;
    }
    
    .tags-container {
      display: flex;
      flex-wrap: wrap;
      gap: 5px;
      margin-top: 15px;
    }
    
    .tag {
      font-size: 12px;
      padding: 4px 8px;
      border-radius: 20px;
      background-color: #f0f0f0;
    }
    
    .tag.skill {
      background-color: #e1f5fe;
      color: #0288d1;
    }
    
    .tag.location {
      background-color: #e8f5e9;
      color: #2e7d32;
    }
    
    .tag.company {
      background-color: #fff8e1;
      color: #ffa000;
    }
    
    .tag.education {
      background-color: #f3e5f5;
      color: #7b1fa2;
    }
    
    .tag.interest {
      background-color: #ffebee;
      color: #c62828;
    }
    
    .tag-source-indicator {
      display: inline-block;
      width: 6px;
      height: 6px;
      border-radius: 50%;
      margin-right: 4px;
    }
    
    .tag-source-indicator.facebook {
      background-color: #1877F2;
    }
    
    .tag-source-indicator.linkedin {
      background-color: #0077B5;
    }
    
    .no-contacts {
      text-align: center;
      padding: 40px;
      background-color: white;
      border-radius: 8px;
      margin-bottom: 30px;
    }
    
    .no-contacts-icon {
      font-size: 48px;
      color: #ddd;
      margin-bottom: 20px;
    }
    
    .connect-options {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-top: 20px;
    }
    
    .connect-btn {
      display: inline-flex;
      align-items: center;
      padding: 8px 16px;
      border-radius: 4px;
      text-decoration: none;
      font-weight: 500;
    }
    
    .connect-btn.facebook {
      background-color: #1877F2;
      color: white;
    }
    
    .connect-btn.linkedin {
      background-color: #0077B5;
      color: white;
    }
    
    .demo-data-section {
      background-color: #fff8e1;
      border: 1px solid #ffd54f;
      border-radius: 4px;
      padding: 15px;
      margin-bottom: 20px;
    }
    
    .demo-data-btn {
      background-color: #f5a623;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 4px;
      font-weight: 500;
      cursor: pointer;
      margin-top: 10px;
    }
    
    .loading-state {
      display: flex;
      justify-content: center;
      padding: 40px;
    }
    
    .spinner {
      display: inline-block;
      width: 40px;
      height: 40px;
      border: 4px solid rgba(245, 166, 35, 0.3);
      border-radius: 50%;
      border-top-color: #f5a623;
      animation: spin 1s ease-in-out infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    @media (max-width: 768px) {
      .contacts-grid {
        grid-template-columns: 1fr;
      }
      
      .toolbar {
        flex-direction: column;
        gap: 10px;
      }
      
      .filter-controls,
      .view-controls {
        flex-wrap: wrap;
      }
    }
  </style>
</head>
<body>
  <header>
    <div class="container header-content">
      <div class="logo">
        <img src="/images/bee-logo.svg" alt="BeeTagged Logo">
        <h1>BeeTagged</h1>
      </div>
      <div class="nav-links">
        <a href="/">Home</a>
        <a href="/contact-manager-standalone.html">Contact Manager</a>
        <a href="/about.html">About</a>
      </div>
    </div>
  </header>

  <main class="main-content">
    <div class="container">
      <div class="page-title">
        <h2>Contact Manager</h2>
        <div id="auth-status" class="auth-indicator none">
          <span class="auth-dot none"></span>
          <span id="auth-text">Not Connected</span>
        </div>
      </div>
      
      <div id="demo-data-section" class="demo-data-section">
        <h3>Welcome to BeeTagged!</h3>
        <p>Connect your social accounts to see your real connections, or use sample data for demonstration.</p>
        <div class="connect-options">
          <a href="javascript:void(0)" id="facebook-connect-btn" class="connect-btn facebook">Connect Facebook</a>
          <a href="javascript:void(0)" id="linkedin-connect-btn" class="connect-btn linkedin">Connect LinkedIn</a>
        </div>
        <button id="load-demo-data" class="demo-data-btn">Load Sample Data</button>
      </div>
      
      <div class="search-bar">
        <input type="text" id="search-input" class="search-input" placeholder="Search contacts by name, location, company, skill...">
        <button id="search-btn" class="search-btn">Search</button>
      </div>
      
      <div class="toolbar">
        <div class="filter-controls">
          <button class="filter-btn active" data-filter="all">All</button>
          <button class="filter-btn" data-filter="facebook">Facebook</button>
          <button class="filter-btn" data-filter="linkedin">LinkedIn</button>
          <button class="filter-btn" data-filter="location:austin">Austin</button>
          <button class="filter-btn" data-filter="skill:javascript">JavaScript</button>
        </div>
        
        <div class="view-controls">
          <button class="view-btn active" data-view="grid">Grid View</button>
          <button class="view-btn" data-view="list">List View</button>
        </div>
      </div>
      
      <div id="loading-state" class="loading-state" style="display: none;">
        <div class="spinner"></div>
      </div>
      
      <div id="no-contacts" class="no-contacts">
        <div class="no-contacts-icon">ðŸ“‹</div>
        <h3>No Contacts Found</h3>
        <p>Connect your social accounts or load sample data to see contacts here.</p>
      </div>
      
      <div id="contacts-grid" class="contacts-grid" style="display: none;"></div>
    </div>
  </main>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // DOM elements
      const contactsGrid = document.getElementById('contacts-grid');
      const noContacts = document.getElementById('no-contacts');
      const loadingState = document.getElementById('loading-state');
      const authStatus = document.getElementById('auth-status');
      const authText = document.getElementById('auth-text');
      const demoDataSection = document.getElementById('demo-data-section');
      const loadDemoBtn = document.getElementById('load-demo-data');
      const facebookConnectBtn = document.getElementById('facebook-connect-btn');
      const linkedinConnectBtn = document.getElementById('linkedin-connect-btn');
      const searchInput = document.getElementById('search-input');
      const searchBtn = document.getElementById('search-btn');
      const filterBtns = document.querySelectorAll('.filter-btn');
      const viewBtns = document.querySelectorAll('.view-btn');
      
      // Variables to store contacts
      let allContacts = [];
      let filteredContacts = [];
      let currentFilter = 'all';
      let currentView = 'grid';
      
      // Check authentication status
      const checkAuth = () => {
        const provider = localStorage.getItem('authProvider');
        const status = localStorage.getItem('authStatus');
        
        if (status === 'authenticated' && provider) {
          authStatus.className = `auth-indicator ${provider}`;
          authText.textContent = `Connected to ${provider.charAt(0).toUpperCase() + provider.slice(1)}`;
          document.querySelector('.auth-dot').className = `auth-dot ${provider}`;
          
          // If we have contacts from this provider, load them
          const contacts = localStorage.getItem(`${provider}Contacts`);
          if (contacts) {
            loadContacts(JSON.parse(contacts), provider);
            demoDataSection.style.display = 'none';
          }
        }
      };
      
      // Load contacts from data
      const loadContacts = (contacts, source) => {
        if (!contacts || contacts.length === 0) {
          console.warn(`No contacts found from ${source}`);
          return;
        }
        
        loadingState.style.display = 'flex';
        noContacts.style.display = 'none';
        
        // Process contacts based on source
        let processedContacts = [];
        
        if (source === 'facebook') {
          processedContacts = contacts.map(contact => ({
            id: contact.id,
            name: contact.name || 'Unknown Name',
            picture: contact.picture?.data?.url || 'https://cdn.jsdelivr.net/npm/simple-icons@v6/icons/facebook.svg',
            email: contact.email || '',
            location: contact.location?.name || '',
            company: '',
            title: '',
            skills: [],
            interests: contact.interests || [],
            source: 'facebook',
            tags: [
              ...(contact.location?.name ? [{ type: 'location', name: contact.location.name }] : []),
              ...(contact.work?.map(w => ({ type: 'company', name: w.employer.name })) || [])
            ]
          }));
        } else if (source === 'linkedin') {
          processedContacts = contacts.map(contact => ({
            id: contact.id,
            name: `${contact.firstName} ${contact.lastName}` || contact.name || 'Unknown Name',
            picture: contact.pictureUrl || 'https://cdn.jsdelivr.net/npm/simple-icons@v6/icons/linkedin.svg',
            email: contact.emailAddress || '',
            location: contact.location || '',
            company: contact.company || '',
            title: contact.title || '',
            skills: contact.skills || [],
            interests: contact.interests || [],
            source: 'linkedin',
            tags: [
              ...(contact.location ? [{ type: 'location', name: contact.location }] : []),
              ...(contact.company ? [{ type: 'company', name: contact.company }] : []),
              ...(contact.skills ? contact.skills.map(skill => ({ type: 'skill', name: skill })) : []),
              ...(contact.interests ? contact.interests.map(interest => ({ type: 'interest', name: interest })) : [])
            ]
          }));
        } else if (source === 'demo') {
          processedContacts = contacts;
        }
        
        // Add to all contacts and render
        allContacts = [...allContacts, ...processedContacts];
        filteredContacts = allContacts;
        
        // Sort by name
        allContacts.sort((a, b) => a.name.localeCompare(b.name));
        
        setTimeout(() => {
          renderContacts();
          loadingState.style.display = 'none';
        }, 500);
      };
      
      // Render contacts to grid
      const renderContacts = () => {
        if (filteredContacts.length === 0) {
          contactsGrid.style.display = 'none';
          noContacts.style.display = 'block';
          return;
        }
        
        contactsGrid.style.display = 'grid';
        noContacts.style.display = 'none';
        
        // Clear current contacts
        contactsGrid.innerHTML = '';
        
        // Update grid/list view
        contactsGrid.className = currentView === 'grid' ? 'contacts-grid' : 'contacts-list';
        
        // Render contacts
        filteredContacts.forEach(contact => {
          const card = document.createElement('div');
          card.className = 'contact-card';
          
          // Generate tags HTML
          const tagsHTML = contact.tags?.map(tag => {
            return `<div class="tag ${tag.type}">
              <span class="tag-source-indicator ${contact.source}"></span>
              ${tag.name}
            </div>`;
          }).join('') || '';
          
          card.innerHTML = `
            <div class="contact-header">
              <div class="contact-avatar">
                <img src="${contact.picture}" alt="${contact.name}">
              </div>
              <div class="contact-name-info">
                <h3 class="contact-name">${contact.name}</h3>
                <p class="contact-title">${contact.title || ''}</p>
              </div>
              <div class="contact-source ${contact.source}">${contact.source}</div>
            </div>
            <div class="contact-body">
              ${contact.email ? `
                <div class="contact-detail">
                  <div class="contact-detail-label">Email</div>
                  <div class="contact-detail-value">${contact.email}</div>
                </div>
              ` : ''}
              ${contact.location ? `
                <div class="contact-detail">
                  <div class="contact-detail-label">Location</div>
                  <div class="contact-detail-value">${contact.location}</div>
                </div>
              ` : ''}
              ${contact.company ? `
                <div class="contact-detail">
                  <div class="contact-detail-label">Company</div>
                  <div class="contact-detail-value">${contact.company}</div>
                </div>
              ` : ''}
              <div class="tags-container">
                ${tagsHTML}
              </div>
            </div>
          `;
          
          contactsGrid.appendChild(card);
        });
      };
      
      // Handle search
      const handleSearch = () => {
        const query = searchInput.value.toLowerCase().trim();
        
        if (!query) {
          filteredContacts = allContacts;
        } else {
          filteredContacts = allContacts.filter(contact => {
            // Search in name, location, company, email
            const nameMatch = contact.name.toLowerCase().includes(query);
            const locationMatch = contact.location.toLowerCase().includes(query);
            const companyMatch = contact.company.toLowerCase().includes(query);
            const emailMatch = contact.email.toLowerCase().includes(query);
            const titleMatch = contact.title.toLowerCase().includes(query);
            
            // Search in skills and interests
            const skillMatch = contact.skills.some(skill => skill.toLowerCase().includes(query));
            const interestMatch = contact.interests.some(interest => interest.toLowerCase().includes(query));
            
            // Search in tags
            const tagMatch = contact.tags?.some(tag => tag.name.toLowerCase().includes(query)) || false;
            
            return nameMatch || locationMatch || companyMatch || emailMatch || titleMatch || skillMatch || interestMatch || tagMatch;
          });
        }
        
        renderContacts();
      };
      
      // Handle filter change
      const handleFilterChange = (filter) => {
        currentFilter = filter;
        
        // Update active button
        filterBtns.forEach(btn => {
          btn.classList.toggle('active', btn.dataset.filter === filter);
        });
        
        // Apply filter
        if (filter === 'all') {
          filteredContacts = allContacts;
        } else if (filter === 'facebook' || filter === 'linkedin') {
          filteredContacts = allContacts.filter(contact => contact.source === filter);
        } else if (filter.startsWith('location:')) {
          const location = filter.split(':')[1].toLowerCase();
          filteredContacts = allContacts.filter(contact => 
            contact.location.toLowerCase().includes(location) ||
            contact.tags?.some(tag => tag.type === 'location' && tag.name.toLowerCase().includes(location))
          );
        } else if (filter.startsWith('skill:')) {
          const skill = filter.split(':')[1].toLowerCase();
          filteredContacts = allContacts.filter(contact => 
            contact.skills.some(s => s.toLowerCase().includes(skill)) ||
            contact.tags?.some(tag => tag.type === 'skill' && tag.name.toLowerCase().includes(skill))
          );
        }
        
        renderContacts();
      };
      
      // Handle view change
      const handleViewChange = (view) => {
        currentView = view;
        
        // Update active button
        viewBtns.forEach(btn => {
          btn.classList.toggle('active', btn.dataset.view === view);
        });
        
        renderContacts();
      };
      
      // Load demo data
      const loadDemoData = () => {
        const demoContacts = [
          {
            id: 'demo_1',
            name: 'Alex Johnson',
            picture: 'https://randomuser.me/api/portraits/men/1.jpg',
            email: 'alex.johnson@example.com',
            location: 'Austin, TX',
            company: 'Tech Innovations',
            title: 'Software Engineer',
            skills: ['JavaScript', 'React', 'Node.js'],
            interests: ['Technology', 'Photography', 'Travel'],
            source: 'demo',
            tags: [
              { type: 'location', name: 'Austin, TX' },
              { type: 'company', name: 'Tech Innovations' },
              { type: 'skill', name: 'JavaScript' },
              { type: 'skill', name: 'React' },
              { type: 'skill', name: 'Node.js' },
              { type: 'interest', name: 'Technology' },
              { type: 'interest', name: 'Photography' }
            ]
          },
          {
            id: 'demo_2',
            name: 'Samantha Lee',
            picture: 'https://randomuser.me/api/portraits/women/2.jpg',
            email: 'samantha.lee@example.com',
            location: 'New York, NY',
            company: 'Global Brands Inc.',
            title: 'Marketing Director',
            skills: ['Digital Marketing', 'Brand Strategy', 'Content Creation'],
            interests: ['Travel', 'Cooking', 'Yoga'],
            source: 'demo',
            tags: [
              { type: 'location', name: 'New York, NY' },
              { type: 'company', name: 'Global Brands Inc.' },
              { type: 'skill', name: 'Digital Marketing' },
              { type: 'skill', name: 'Brand Strategy' },
              { type: 'interest', name: 'Travel' },
              { type: 'interest', name: 'Cooking' }
            ]
          },
          {
            id: 'demo_3',
            name: 'Michael Chen',
            picture: 'https://randomuser.me/api/portraits/men/3.jpg',
            email: 'michael.chen@example.com',
            location: 'San Francisco, CA',
            company: 'Innovative Solutions',
            title: 'Product Manager',
            skills: ['Product Management', 'UX Design', 'Analytics'],
            interests: ['Hiking', 'Photography', 'Reading'],
            source: 'demo',
            tags: [
              { type: 'location', name: 'San Francisco, CA' },
              { type: 'company', name: 'Innovative Solutions' },
              { type: 'skill', name: 'Product Management' },
              { type: 'skill', name: 'UX Design' },
              { type: 'interest', name: 'Hiking' },
              { type: 'interest', name: 'Photography' }
            ]
          },
          {
            id: 'demo_4',
            name: 'Jessica Taylor',
            picture: 'https://randomuser.me/api/portraits/women/4.jpg',
            email: 'jessica.taylor@example.com',
            location: 'Austin, TX',
            company: 'Creative Solutions',
            title: 'Graphic Designer',
            skills: ['Adobe Creative Suite', 'UI Design', 'Branding'],
            interests: ['Art', 'Music', 'Travel'],
            source: 'demo',
            tags: [
              { type: 'location', name: 'Austin, TX' },
              { type: 'company', name: 'Creative Solutions' },
              { type: 'skill', name: 'Adobe Creative Suite' },
              { type: 'skill', name: 'UI Design' },
              { type: 'interest', name: 'Art' },
              { type: 'interest', name: 'Music' }
            ]
          },
          {
            id: 'demo_5',
            name: 'David Rodriguez',
            picture: 'https://randomuser.me/api/portraits/men/5.jpg',
            email: 'david.rodriguez@example.com',
            location: 'Chicago, IL',
            company: 'Financial Services Group',
            title: 'Financial Analyst',
            skills: ['Financial Modeling', 'Data Analysis', 'Excel'],
            interests: ['Investing', 'Running', 'Cooking'],
            source: 'demo',
            tags: [
              { type: 'location', name: 'Chicago, IL' },
              { type: 'company', name: 'Financial Services Group' },
              { type: 'skill', name: 'Financial Modeling' },
              { type: 'skill', name: 'Data Analysis' },
              { type: 'interest', name: 'Investing' },
              { type: 'interest', name: 'Running' }
            ]
          }
        ];
        
        loadContacts(demoContacts, 'demo');
      };
      
      // Event listeners
      searchBtn.addEventListener('click', handleSearch);
      searchInput.addEventListener('keyup', e => {
        if (e.key === 'Enter') handleSearch();
      });
      
      filterBtns.forEach(btn => {
        btn.addEventListener('click', () => handleFilterChange(btn.dataset.filter));
      });
      
      viewBtns.forEach(btn => {
        btn.addEventListener('click', () => handleViewChange(btn.dataset.view));
      });
      
      loadDemoBtn.addEventListener('click', loadDemoData);
      
      facebookConnectBtn.addEventListener('click', async () => {
        try {
          const response = await fetch('/api/auth/facebook/url');
          const data = await response.json();
          
          if (data.url) {
            window.location.href = data.url;
          }
        } catch (error) {
          console.error('Facebook connect error:', error);
        }
      });
      
      linkedinConnectBtn.addEventListener('click', async () => {
        try {
          const response = await fetch('/api/auth/linkedin/url');
          const data = await response.json();
          
          if (data.url) {
            window.location.href = data.url;
          }
        } catch (error) {
          console.error('LinkedIn connect error:', error);
        }
      });
      
      // Initialize
      checkAuth();
      
      // Log application status
      console.log('BeeTagged application loaded at ' + new Date().toISOString());
    });
  </script>
</body>
</html>