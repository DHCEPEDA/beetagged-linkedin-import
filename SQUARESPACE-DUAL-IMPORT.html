<!-- BeeTagged Dual Import Widget for Squarespace Header Injection -->
<!-- Copy this code into: Settings > Advanced > Code Injection > HEADER -->

<div id="beetagged-widget-container"></div>

<script>
window.addEventListener('load', function() {
  const BACKEND_URL = 'https://beetagged-app-53414697acd3.herokuapp.com';
  
  // Create the full widget HTML with dual import functionality
  const widgetHTML = `
    <div style="
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 2rem;
      box-sizing: border-box;
    ">
      <div style="
        width: 100%;
        max-width: 1000px;
        padding: 2rem;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border-radius: 16px;
        color: white;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        box-shadow: 0 20px 40px rgba(0,0,0,0.1);
      ">
        <div style="text-align: center; margin-bottom: 2rem;">
          <h1 style="font-size: 2.5rem; font-weight: 700; margin: 0 0 0.5rem 0;">üè∑Ô∏è BeeTagged</h1>
          <p style="font-size: 1.1rem; opacity: 0.9; margin: 0;">AI-Powered Contact Intelligence & Search</p>
        </div>
        
        <div style="display: flex; background: rgba(255,255,255,0.1); border-radius: 12px; padding: 4px; margin-bottom: 2rem;">
          <button id="search-tab" style="flex: 1; padding: 12px 16px; border: none; background: rgba(255,255,255,0.2); color: white; cursor: pointer; border-radius: 8px; font-weight: 500; box-shadow: 0 4px 12px rgba(0,0,0,0.1); transition: all 0.3s ease;">üîç Search Contacts</button>
          <button id="import-tab" style="flex: 1; padding: 12px 16px; border: none; background: transparent; color: white; cursor: pointer; border-radius: 8px; font-weight: 500; transition: all 0.3s ease;">üìÅ Import LinkedIn</button>
        </div>
        
        <!-- Search Tab Content -->
        <div id="search-content" style="display: block;">
          <div style="background: rgba(255,255,255,0.1); padding: 2rem; border-radius: 12px; margin-bottom: 1rem;">
            <input type="text" id="search-input" placeholder="Search: 'Google employees', 'people in San Francisco', 'Michael'" style="
              width: 100%;
              padding: 12px 16px;
              border: none;
              border-radius: 8px;
              font-size: 1rem;
              margin-bottom: 1rem;
              background: rgba(255,255,255,0.9);
              color: #333;
              box-sizing: border-box;
            ">
            
            <button id="search-btn" style="
              width: 100%;
              padding: 12px 24px;
              border: none;
              border-radius: 8px;
              font-weight: 600;
              cursor: pointer;
              background: rgba(255,255,255,0.2);
              color: white;
              border: 2px solid rgba(255,255,255,0.3);
              transition: all 0.3s ease;
            ">Search Contacts</button>
            
            <div style="display: flex; flex-wrap: wrap; gap: 8px; margin-top: 1rem; justify-content: center;">
              <span class="example-tag" data-query="Google" style="background: rgba(255,255,255,0.2); padding: 6px 12px; border-radius: 16px; font-size: 0.85rem; cursor: pointer; border: 1px solid rgba(255,255,255,0.3);">Google workers</span>
              <span class="example-tag" data-query="Michael" style="background: rgba(255,255,255,0.2); padding: 6px 12px; border-radius: 16px; font-size: 0.85rem; cursor: pointer; border: 1px solid rgba(255,255,255,0.3);">Find Michael</span>
              <span class="example-tag" data-query="San Francisco" style="background: rgba(255,255,255,0.2); padding: 6px 12px; border-radius: 16px; font-size: 0.85rem; cursor: pointer; border: 1px solid rgba(255,255,255,0.3);">San Francisco</span>
            </div>
          </div>
          
          <div id="search-results" style="
            background: rgba(255,255,255,0.1);
            border-radius: 12px;
            padding: 1.5rem;
            margin-top: 1rem;
            display: none;
          ">
            <h3 style="margin: 0 0 1rem 0; text-align: center;">Search Results</h3>
            <div id="results-list"></div>
          </div>
        </div>
        
        <!-- Import Tab Content -->
        <div id="import-content" style="display: none;">
          <div style="background: rgba(255,255,255,0.1); padding: 2rem; border-radius: 12px;">
            <h3 style="margin: 0 0 1.5rem 0; text-align: center;">üìÅ LinkedIn Import</h3>
            
            <!-- Dual File Upload -->
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 2rem;">
              <!-- Contacts CSV -->
              <div id="contacts-upload-zone" style="
                border: 2px dashed rgba(255,255,255,0.3);
                border-radius: 12px;
                padding: 1.5rem;
                text-align: center;
                cursor: pointer;
                background: rgba(255,255,255,0.05);
                transition: all 0.3s ease;
              ">
                <h4 style="margin: 0 0 0.5rem 0; font-size: 1rem;">üìã Contacts CSV</h4>
                <p style="margin: 0 0 0.5rem 0; font-size: 0.9rem;">Upload contacts export</p>
                <p style="font-size: 0.8rem; opacity: 0.7; margin: 0;">Contains detailed info</p>
                <input type="file" id="contacts-file-input" accept=".csv" style="display: none;">
              </div>
              
              <!-- Connections CSV -->
              <div id="connections-upload-zone" style="
                border: 2px dashed rgba(255,255,255,0.3);
                border-radius: 12px;
                padding: 1.5rem;
                text-align: center;
                cursor: pointer;
                background: rgba(255,255,255,0.05);
                transition: all 0.3s ease;
              ">
                <h4 style="margin: 0 0 0.5rem 0; font-size: 1rem;">üîó Connections CSV</h4>
                <p style="margin: 0 0 0.5rem 0; font-size: 0.9rem;">Upload connections export</p>
                <p style="font-size: 0.8rem; opacity: 0.7; margin: 0;">Contains network data</p>
                <input type="file" id="connections-file-input" accept=".csv" style="display: none;">
              </div>
            </div>
            
            <!-- Process Button -->
            <button id="process-files-btn" style="
              width: 100%;
              padding: 12px 24px;
              border: none;
              border-radius: 8px;
              font-weight: 600;
              cursor: pointer;
              background: rgba(255,255,255,0.2);
              color: white;
              border: 2px solid rgba(255,255,255,0.3);
              transition: all 0.3s ease;
              margin-bottom: 1rem;
              display: none;
            ">Process Files & Check for Duplicates</button>
            
            <div id="upload-status" style="display: none;"></div>
            
            <div style="margin-top: 1rem;">
              <h4 style="margin: 0 0 0.5rem 0; text-align: center;">üìã How to export from LinkedIn:</h4>
              <ol style="font-size: 0.9rem; opacity: 0.9; padding-left: 1.2rem; margin: 0; max-width: 600px; margin: 0 auto;">
                <li>Go to LinkedIn Settings & Privacy</li>
                <li>Click "Data Privacy" ‚Üí "Get a copy of your data"</li>
                <li>Select both "Contacts" and "Connections"</li>
                <li>Download both CSV files when ready</li>
                <li>Upload both files here for optimal results</li>
              </ol>
            </div>
          </div>
        </div>
        
        <div id="global-message" style="display: none;"></div>
      </div>
    </div>
    
    <!-- Baseball Card Modal -->
    <div id="baseball-card-modal" style="
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.8);
      z-index: 10000;
      padding: 2rem;
      box-sizing: border-box;
      overflow-y: auto;
    ">
      <div style="
        max-width: 500px;
        margin: 0 auto;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border-radius: 20px;
        color: white;
        box-shadow: 0 30px 60px rgba(0,0,0,0.3);
        position: relative;
      ">
        <button id="close-modal" style="
          position: absolute;
          top: 1rem;
          right: 1rem;
          background: rgba(255,255,255,0.2);
          border: none;
          color: white;
          width: 40px;
          height: 40px;
          border-radius: 50%;
          cursor: pointer;
          font-size: 1.2rem;
          transition: all 0.3s ease;
        ">√ó</button>
        
        <div id="baseball-card-content"></div>
      </div>
    </div>
    
    <!-- Duplicate Resolution Modal -->
    <div id="duplicate-modal" style="
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.9);
      z-index: 10001;
      padding: 2rem;
      box-sizing: border-box;
      overflow-y: auto;
    ">
      <div style="
        max-width: 800px;
        margin: 0 auto;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border-radius: 20px;
        color: white;
        box-shadow: 0 30px 60px rgba(0,0,0,0.3);
        position: relative;
      ">
        <div style="padding: 2rem;">
          <h2 style="margin: 0 0 1rem 0; text-align: center;">üîç Duplicate Contacts Found</h2>
          <p style="margin: 0 0 2rem 0; text-align: center; opacity: 0.9;">We found contacts that might be the same person. Choose how to handle them:</p>
          
          <div id="duplicate-list" style="max-height: 400px; overflow-y: auto; margin-bottom: 2rem;"></div>
          
          <div style="display: flex; gap: 1rem; justify-content: center;">
            <button id="consolidate-all-btn" style="
              padding: 12px 24px;
              border: none;
              border-radius: 8px;
              font-weight: 600;
              cursor: pointer;
              background: rgba(34, 197, 94, 0.8);
              color: white;
              transition: all 0.3s ease;
            ">Consolidate All</button>
            
            <button id="keep-separate-btn" style="
              padding: 12px 24px;
              border: none;
              border-radius: 8px;
              font-weight: 600;
              cursor: pointer;
              background: rgba(239, 68, 68, 0.8);
              color: white;
              transition: all 0.3s ease;
            ">Keep Separate</button>
            
            <button id="review-individually-btn" style="
              padding: 12px 24px;
              border: none;
              border-radius: 8px;
              font-weight: 600;
              cursor: pointer;
              background: rgba(255,255,255,0.2);
              color: white;
              border: 2px solid rgba(255,255,255,0.3);
              transition: all 0.3s ease;
            ">Review Each</button>
          </div>
        </div>
      </div>
    </div>
  `;
  
  // Global variables for file processing
  let contactsFile = null;
  let connectionsFile = null;
  let pendingDuplicates = [];
  
  // Insert widget into container
  const container = document.getElementById('beetagged-widget-container');
  if (container) {
    container.innerHTML = widgetHTML;
    setupWidget();
  }
  
  function setupWidget() {
    // Tab switching
    const searchTab = document.getElementById('search-tab');
    const importTab = document.getElementById('import-tab');
    const searchContent = document.getElementById('search-content');
    const importContent = document.getElementById('import-content');
    
    if (searchTab && importTab && searchContent && importContent) {
      searchTab.onclick = function() {
        searchTab.style.background = 'rgba(255,255,255,0.2)';
        searchTab.style.boxShadow = '0 4px 12px rgba(0,0,0,0.1)';
        importTab.style.background = 'transparent';
        importTab.style.boxShadow = 'none';
        searchContent.style.display = 'block';
        importContent.style.display = 'none';
      };
      
      importTab.onclick = function() {
        importTab.style.background = 'rgba(255,255,255,0.2)';
        importTab.style.boxShadow = '0 4px 12px rgba(0,0,0,0.1)';
        searchTab.style.background = 'transparent';
        searchTab.style.boxShadow = 'none';
        importContent.style.display = 'block';
        searchContent.style.display = 'none';
      };
    }
    
    // Search functionality
    const searchBtn = document.getElementById('search-btn');
    const searchInput = document.getElementById('search-input');
    
    if (searchBtn) searchBtn.onclick = performSearch;
    if (searchInput) {
      searchInput.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') performSearch();
      });
    }
    
    // Example tags
    const exampleTags = document.querySelectorAll('.example-tag');
    exampleTags.forEach(tag => {
      tag.onclick = function() {
        const query = this.getAttribute('data-query');
        if (searchInput) {
          searchInput.value = query;
          performSearch();
        }
      };
      tag.onmouseover = function() { this.style.background = 'rgba(255,255,255,0.3)'; };
      tag.onmouseout = function() { this.style.background = 'rgba(255,255,255,0.2)'; };
    });
    
    // Dual file upload setup
    setupDualFileUpload();
    
    // Modal functionality
    setupModals();
    
    // Load sample contacts
    loadSampleContacts();
  }
  
  function setupDualFileUpload() {
    const contactsZone = document.getElementById('contacts-upload-zone');
    const connectionsZone = document.getElementById('connections-upload-zone');
    const contactsInput = document.getElementById('contacts-file-input');
    const connectionsInput = document.getElementById('connections-file-input');
    const processBtn = document.getElementById('process-files-btn');
    
    // Contacts file upload
    if (contactsZone && contactsInput) {
      contactsZone.onclick = () => contactsInput.click();
      
      contactsZone.ondragover = (e) => {
        e.preventDefault();
        contactsZone.style.borderColor = 'rgba(255,255,255,0.6)';
        contactsZone.style.background = 'rgba(255,255,255,0.1)';
      };
      
      contactsZone.ondragleave = (e) => {
        e.preventDefault();
        contactsZone.style.borderColor = 'rgba(255,255,255,0.3)';
        contactsZone.style.background = 'rgba(255,255,255,0.05)';
      };
      
      contactsZone.ondrop = (e) => {
        e.preventDefault();
        contactsZone.style.borderColor = 'rgba(255,255,255,0.3)';
        contactsZone.style.background = 'rgba(255,255,255,0.05)';
        if (e.dataTransfer.files.length > 0) {
          handleContactsFile(e.dataTransfer.files[0]);
        }
      };
      
      contactsInput.onchange = (e) => {
        if (e.target.files.length > 0) {
          handleContactsFile(e.target.files[0]);
        }
      };
    }
    
    // Connections file upload
    if (connectionsZone && connectionsInput) {
      connectionsZone.onclick = () => connectionsInput.click();
      
      connectionsZone.ondragover = (e) => {
        e.preventDefault();
        connectionsZone.style.borderColor = 'rgba(255,255,255,0.6)';
        connectionsZone.style.background = 'rgba(255,255,255,0.1)';
      };
      
      connectionsZone.ondragleave = (e) => {
        e.preventDefault();
        connectionsZone.style.borderColor = 'rgba(255,255,255,0.3)';
        connectionsZone.style.background = 'rgba(255,255,255,0.05)';
      };
      
      connectionsZone.ondrop = (e) => {
        e.preventDefault();
        connectionsZone.style.borderColor = 'rgba(255,255,255,0.3)';
        connectionsZone.style.background = 'rgba(255,255,255,0.05)';
        if (e.dataTransfer.files.length > 0) {
          handleConnectionsFile(e.dataTransfer.files[0]);
        }
      };
      
      connectionsInput.onchange = (e) => {
        if (e.target.files.length > 0) {
          handleConnectionsFile(e.target.files[0]);
        }
      };
    }
    
    // Process files button
    if (processBtn) {
      processBtn.onclick = processFiles;
    }
  }
  
  function handleContactsFile(file) {
    if (!file.name.endsWith('.csv')) {
      showMessage('Please select a CSV file.', 'error');
      return;
    }
    
    contactsFile = file;
    const zone = document.getElementById('contacts-upload-zone');
    if (zone) {
      zone.innerHTML = '<h4 style="margin: 0 0 0.5rem 0; font-size: 1rem;">‚úÖ Contacts CSV</h4><p style="margin: 0; font-size: 0.9rem;">' + file.name + '</p>';
      zone.style.borderColor = 'rgba(34, 197, 94, 0.6)';
      zone.style.background = 'rgba(34, 197, 94, 0.1)';
    }
    
    updateProcessButton();
  }
  
  function handleConnectionsFile(file) {
    if (!file.name.endsWith('.csv')) {
      showMessage('Please select a CSV file.', 'error');
      return;
    }
    
    connectionsFile = file;
    const zone = document.getElementById('connections-upload-zone');
    if (zone) {
      zone.innerHTML = '<h4 style="margin: 0 0 0.5rem 0; font-size: 1rem;">‚úÖ Connections CSV</h4><p style="margin: 0; font-size: 0.9rem;">' + file.name + '</p>';
      zone.style.borderColor = 'rgba(34, 197, 94, 0.6)';
      zone.style.background = 'rgba(34, 197, 94, 0.1)';
    }
    
    updateProcessButton();
  }
  
  function updateProcessButton() {
    const processBtn = document.getElementById('process-files-btn');
    if (processBtn && (contactsFile || connectionsFile)) {
      processBtn.style.display = 'block';
      
      if (contactsFile && connectionsFile) {
        processBtn.textContent = 'Process Both Files & Check for Duplicates';
      } else if (contactsFile) {
        processBtn.textContent = 'Process Contacts File & Check for Duplicates';
      } else {
        processBtn.textContent = 'Process Connections File & Check for Duplicates';
      }
    }
  }
  
  async function processFiles() {
    const uploadStatus = document.getElementById('upload-status');
    const processBtn = document.getElementById('process-files-btn');
    
    if (!contactsFile && !connectionsFile) {
      showMessage('Please select at least one CSV file.', 'error');
      return;
    }
    
    if (uploadStatus) {
      uploadStatus.style.display = 'block';
      uploadStatus.innerHTML = '<div style="text-align: center; padding: 1rem;">Processing files and checking for duplicates...</div>';
    }
    
    if (processBtn) {
      processBtn.disabled = true;
      processBtn.textContent = 'Processing...';
    }
    
    try {
      const formData = new FormData();
      if (contactsFile) formData.append('contactsFile', contactsFile);
      if (connectionsFile) formData.append('connectionsFile', connectionsFile);
      
      const response = await fetch(BACKEND_URL + '/api/import/linkedin', {
        method: 'POST',
        body: formData,
      });
      
      if (!response.ok) {
        throw new Error('Upload failed');
      }
      
      const data = await response.json();
      
      if (data.duplicates && data.duplicates.length > 0) {
        // Show duplicate resolution modal
        pendingDuplicates = data.duplicates;
        showDuplicateModal(data.duplicates);
      } else {
        // No duplicates found, import successful
        const count = data.imported || data.count || 'some';
        showMessage(\`Successfully imported \${count} contacts with no duplicates found!\`, 'success');
      }
      
    } catch (error) {
      showMessage('Upload failed. Please try again.', 'error');
    } finally {
      if (uploadStatus) {
        uploadStatus.style.display = 'none';
      }
      if (processBtn) {
        processBtn.disabled = false;
        updateProcessButton();
      }
    }
  }
  
  function showDuplicateModal(duplicates) {
    const modal = document.getElementById('duplicate-modal');
    const duplicateList = document.getElementById('duplicate-list');
    
    if (!modal || !duplicateList) return;
    
    const listHTML = duplicates.map((group, index) => \`
      <div style="background: rgba(255,255,255,0.1); border-radius: 8px; padding: 1rem; margin-bottom: 1rem;">
        <h4 style="margin: 0 0 0.5rem 0;">Potential Match #\${index + 1}</h4>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
          \${group.map(contact => \`
            <div style="background: rgba(255,255,255,0.05); padding: 0.75rem; border-radius: 6px;">
              <div style="font-weight: 600;">\${contact.name}</div>
              <div style="font-size: 0.9rem; opacity: 0.8;">\${contact.company || 'No company'}</div>
              <div style="font-size: 0.8rem; opacity: 0.7;">\${contact.email || 'No email'}</div>
              <div style="font-size: 0.8rem; opacity: 0.6;">Source: \${contact.source}</div>
            </div>
          \`).join('')}
        </div>
      </div>
    \`).join('');
    
    duplicateList.innerHTML = listHTML;
    modal.style.display = 'block';
  }
  
  function setupModals() {
    // Baseball card modal
    const cardModal = document.getElementById('baseball-card-modal');
    const closeModal = document.getElementById('close-modal');
    
    if (closeModal && cardModal) {
      closeModal.onclick = () => cardModal.style.display = 'none';
      cardModal.onclick = (e) => {
        if (e.target === cardModal) cardModal.style.display = 'none';
      };
    }
    
    // Duplicate resolution modal
    const duplicateModal = document.getElementById('duplicate-modal');
    const consolidateAllBtn = document.getElementById('consolidate-all-btn');
    const keepSeparateBtn = document.getElementById('keep-separate-btn');
    const reviewIndividuallyBtn = document.getElementById('review-individually-btn');
    
    if (consolidateAllBtn) {
      consolidateAllBtn.onclick = () => resolveDuplicates('consolidate');
    }
    
    if (keepSeparateBtn) {
      keepSeparateBtn.onclick = () => resolveDuplicates('separate');
    }
    
    if (reviewIndividuallyBtn) {
      reviewIndividuallyBtn.onclick = () => resolveDuplicates('review');
    }
  }
  
  async function resolveDuplicates(action) {
    const duplicateModal = document.getElementById('duplicate-modal');
    
    try {
      const response = await fetch(BACKEND_URL + '/api/import/resolve-duplicates', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          duplicates: pendingDuplicates,
          action: action
        })
      });
      
      if (!response.ok) throw new Error('Resolution failed');
      
      const data = await response.json();
      
      if (duplicateModal) duplicateModal.style.display = 'none';
      
      let message = '';
      if (action === 'consolidate') {
        message = \`Successfully consolidated \${data.consolidated || 0} duplicate contacts!\`;
      } else if (action === 'separate') {
        message = \`Imported \${data.imported || 0} contacts as separate entries.\`;
      } else {
        message = 'Duplicate resolution completed. Check individual contacts.';
      }
      
      showMessage(message, 'success');
      pendingDuplicates = [];
      
    } catch (error) {
      showMessage('Failed to resolve duplicates. Please try again.', 'error');
    }
  }
  
  function showBaseballCard(contact) {
    const modal = document.getElementById('baseball-card-modal');
    const content = document.getElementById('baseball-card-content');
    
    if (!modal || !content) return;
    
    const initials = contact.name ? contact.name.split(' ').map(n => n[0]).join('').toUpperCase() : '??';
    
    const cardHTML = \`
      <div style="padding: 2rem;">
        <div style="text-align: center; margin-bottom: 2rem;">
          <div style="
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: rgba(255,255,255,0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            font-weight: bold;
            margin: 0 auto 1rem auto;
            border: 4px solid rgba(255,255,255,0.3);
          ">\${initials}</div>
          <h2 style="margin: 0 0 0.5rem 0; font-size: 1.8rem;">\${contact.name || 'Unknown Name'}</h2>
          <p style="margin: 0; opacity: 0.8; font-size: 1.1rem;">\${contact.position || 'Position not specified'}</p>
        </div>
        
        <div style="background: rgba(255,255,255,0.1); border-radius: 12px; padding: 1.5rem;">
          <h3 style="margin: 0 0 1rem 0; font-size: 1.2rem; text-align: center;">Contact Information</h3>
          
          <div style="display: grid; gap: 0.75rem;">
            \${contact.company ? \`<div style="display: flex; align-items: center;"><span style="font-weight: 600; min-width: 80px;">Company:</span><span>\${contact.company}</span></div>\` : ''}
            \${contact.position ? \`<div style="display: flex; align-items: center;"><span style="font-weight: 600; min-width: 80px;">Position:</span><span>\${contact.position}</span></div>\` : ''}
            \${contact.location ? \`<div style="display: flex; align-items: center;"><span style="font-weight: 600; min-width: 80px;">Location:</span><span>\${contact.location}</span></div>\` : ''}
            \${contact.email ? \`<div style="display: flex; align-items: center;"><span style="font-weight: 600; min-width: 80px;">Email:</span><span style="word-break: break-all;">\${contact.email}</span></div>\` : ''}
            \${contact.source ? \`<div style="display: flex; align-items: center;"><span style="font-weight: 600; min-width: 80px;">Source:</span><span style="text-transform: capitalize;">\${contact.source.replace('_', ' ')}</span></div>\` : ''}
          </div>
        </div>
      </div>
    \`;
    
    content.innerHTML = cardHTML;
    modal.style.display = 'block';
  }
  
  async function loadSampleContacts() {
    try {
      const response = await fetch(BACKEND_URL + '/api/contacts?limit=3');
      if (response.ok) {
        const contacts = await response.json();
        if (contacts && contacts.length > 0) {
          displaySampleContacts(contacts);
        }
      }
    } catch (error) {
      console.log('Sample contacts failed to load - widget still functional');
    }
  }
  
  function displaySampleContacts(contacts) {
    const resultsList = document.getElementById('results-list');
    const resultsContainer = document.getElementById('search-results');
    
    if (resultsList && resultsContainer) {
      resultsList.innerHTML = 
        '<div style="margin-bottom: 1rem; opacity: 0.8; font-size: 0.9rem; text-align: center;"><strong>‚úÖ Connected to your contact database! Sample contacts:</strong></div>' +
        '<div style="display: grid; gap: 1rem;">' +
        contacts.map(contact => createContactCard(contact)).join('') +
        '</div>' +
        '<div style="margin-top: 1rem; opacity: 0.7; font-size: 0.85rem; text-align: center;">Try searching above to find specific contacts! Click any name for detailed view.</div>';
      resultsContainer.style.display = 'block';
    }
  }
  
  function createContactCard(contact) {
    const details = [];
    if (contact.company) details.push(contact.company);
    if (contact.position) details.push(contact.position);
    if (contact.location) details.push(contact.location);
    
    return \`
      <div style="
        background: rgba(255,255,255,0.1); 
        border-radius: 8px; 
        padding: 1rem; 
        border: 1px solid rgba(255,255,255,0.2);
        transition: all 0.3s ease;
        cursor: pointer;
      " 
      onmouseover="this.style.background='rgba(255,255,255,0.15)'; this.style.transform='translateY(-2px)'"
      onmouseout="this.style.background='rgba(255,255,255,0.1)'; this.style.transform='translateY(0)'"
      onclick="showBaseballCard(\${JSON.stringify(contact).replace(/"/g, '&quot;')})">
        <div style="font-weight: 600; margin-bottom: 0.5rem; font-size: 1.1rem; color: #FFE4B5;">
          \${contact.name || 'Unknown Name'}
        </div>
        <div style="opacity: 0.8; font-size: 0.9rem;">
          \${details.length > 0 ? details.join(' ‚Ä¢ ') : 'No additional details available'}
        </div>
        <div style="opacity: 0.6; font-size: 0.8rem; margin-top: 0.5rem;">
          Source: \${contact.source || 'Unknown'} ‚Ä¢ Click for details
        </div>
      </div>
    \`;
  }
  
  async function performSearch() {
    const input = document.getElementById('search-input');
    const btn = document.getElementById('search-btn');
    const results = document.getElementById('search-results');
    const resultsList = document.getElementById('results-list');
    
    if (!input || !btn || !results || !resultsList) return;
    
    const query = input.value.trim();
    if (!query) return;
    
    btn.disabled = true;
    btn.textContent = 'Searching...';
    
    try {
      const response = await fetch(BACKEND_URL + '/api/search/natural?q=' + encodeURIComponent(query));
      const data = await response.json();
      const contacts = data.results || data;
      
      if (contacts && contacts.length > 0) {
        resultsList.innerHTML = 
          \`<div style="margin-bottom: 1rem; opacity: 0.8; font-size: 0.9rem; text-align: center;"><strong>Found \${contacts.length} contacts matching "\${query}":</strong></div>\` +
          '<div style="display: grid; gap: 1rem;">' +
          contacts.map(contact => createContactCard(contact)).join('') +
          '</div>';
        results.style.display = 'block';
      } else {
        resultsList.innerHTML = '<p style="text-align: center;">No contacts found matching your search. Try different keywords.</p>';
        results.style.display = 'block';
      }
    } catch (error) {
      showMessage('Search failed. Please try again.', 'error');
    } finally {
      btn.disabled = false;
      btn.textContent = 'Search Contacts';
    }
  }
  
  function showMessage(message, type) {
    const messageElement = document.getElementById('global-message');
    if (messageElement) {
      const bgColor = type === 'error' ? 'rgba(239, 68, 68, 0.2)' : 'rgba(34, 197, 94, 0.2)';
      const borderColor = type === 'error' ? 'rgba(239, 68, 68, 0.3)' : 'rgba(34, 197, 94, 0.3)';
      
      messageElement.innerHTML = '<div style="padding: 1rem; border-radius: 8px; margin: 1rem 0; text-align: center; background: ' + bgColor + '; border: 1px solid ' + borderColor + ';">' + message + '</div>';
      messageElement.style.display = 'block';
      
      setTimeout(() => messageElement.style.display = 'none', 5000);
    }
  }
  
  // Make functions available globally
  window.showBaseballCard = showBaseballCard;
});
</script>